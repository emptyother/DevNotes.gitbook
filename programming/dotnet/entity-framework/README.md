---
description: Tips and tricks for Entity Framework.
---

# Entity Framework

## Dictionary

| Word | Meaning |
| :--- | :--- |
| Entity | A class in entity framework. |
| Navigation object | These properties: `public virtual ICollection<ChildItems> ChildItems { get; set; }`. |

## Tips

* Chain multiple LINQ queries instead of doing everything inside one query. LINQ

  does a fair bit of optimizing at runtime, and all this will be wasted if you

  do Where\(p1==4 && p2==5\).

## Configuration in the constructor

Disable database migration:

```csharp
System.Data.Entity.Database.SetInitializer<MyDbContext>(null);
```

Enable lazy loading:

```csharp
Configuration.LazyLoadingEnabled = true;
```

## Useful class attributes

```csharp
using System.ComponentModel.DataAnnotations.Schema;
```

| Attributes | Description |
| :--- | :--- |
| `Table (str)` | The real name of the table in the database. |
| `JsonIgnore` | Class will not be serialized by Newtonsoft.Json, but preserves reference |
| `IgnoreDataMember` | Will not be serialized by XmlDCSerializer, but preserves reference |

## Useful property attributes

```csharp
using System.ComponentModel.DataAnnotations;
using Newtonsoft.Json;
```

| Attributes | Description |
| :--- | :--- |
| `Column (str)` | The real name of the column in the database. |
| `Key` | This field is part of a primary key. You can have more than one primary key, but then you also need to add the `Column(Order = i)` attribute. |
| `ForeignKey (nameof(IdProperty))` | This property is the Foreign Key for the navigational object called IdProperty. |
| `ForeignKey (nameOf(IdPropertyId))` | This property is a navigational object and the foreign key is the property named IdPropertyId. |
| `Required (AllowEmptyStrings=true)` | Property can't be null, but it can be an empty string. |
| `MaxLength (i)` | Max string length. |
| `DatabaseGenerated (DatabaseGeneratedOption.Identity)` | This field is generated by the database on insert. |
| `DatabaseGenerated (DatabaseGeneratedOption.Computed)` | This field is generated by the database on insert and on update. |
| `JsonIgnore` | Will not be serialized by Newtonsoft.Json |
| `IgnoreDataMember` | Will not be serialized by XmlDCSerializer |
| `JsonObject(IsReference = true)` | Mark as reference. \(? no idea how this work yet\) |

## Load related entities in query

**Alternative 1**:

If you want the values of related items, you need to include them. This also includes anything else from the same related table, so if your column have multiple references to a user table then all of them will be included even if you only specified one.

```csharp
using System.Data.Entity;
M_d_exercises.Include(e => e.Createdby)
```

**Alternative 2**:

There is also a method called `Load()`. Consider using that instead:

```csharp
Context.Products.Load();
Context.ProductVersions.Load();
Context.Lines.Load();
Context.Employees.Load();
Context.MeasurementType.Load();
Context.Measurements.Where(m => m.MeasurementTime >= DateTime.Now.AddDays(-1)).ToList();
```

**Source**: [https://stackoverflow.com/questions/19319116/](https://stackoverflow.com/questions/19319116/)

**Alternative 3**:

You can do lazy loading.

## Lazy loading

If lazy loading is enabled, any field that has the "virtual" modifier will be loaded when you try to access it.

```csharp
[ForeignKey("D_agegroup_id")]
public virtual D_agegroup D_agegroup { get; set; }
```

## Lists

**Source**: [https://stackoverflow.com/questions/10113244/](https://stackoverflow.com/questions/10113244/why-use-icollection-and-not-ienumerable-or-listt-on-many-many-one-many-relatio)

| Type | Usage |
| :--- | :--- |
| `IEnumerable<>` | List of objects that only needs to be iterated through. |
| `ICollection<>` | List of objects that needs to be iterated and modified. In order for the dynamic proxy to be created as a navigation property, the virtual type must implement ICollection. |
| `List<>` | List of objects that needs to be iterated, modified, sorted, etc. |

* [Source 1](https://stackoverflow.com/questions/10113244/why-use-icollection-and-not-ienumerable-or-listt-on-many-many-one-many-relatio)

